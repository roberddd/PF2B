const syncGroups={};class AssetViewer360{constructor(t){this.container=t,this.img=t.querySelector("img"),this.frameCount=parseInt(t.dataset.frames)||36,this.currentFrame=0,this.isDragging=!1,this.startX=0,this.startFrame=0,this.accumulatedDelta=0,this.isInitialized=!1,this.isFullscreen=!1,this.syncGroup=this.container.dataset.syncGroup||null,this.init()}init(){this.syncGroup&&(syncGroups[this.syncGroup]||(syncGroups[this.syncGroup]=[]),syncGroups[this.syncGroup].push(this)),this.img.complete?this.setup():this.img.addEventListener("load",(()=>this.setup())),this.setupVisibilityObserver()}setupVisibilityObserver(){const t=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&!this.isInitialized&&this.img.complete&&this.setup()}))}),{threshold:.01});t.observe(this.container),this.observer=t}setup(){if(this.isInitialized)return;if(0===this.container.offsetWidth||0===this.container.offsetHeight)return;if(this.isInitialized=!0,this.layout=this.container.dataset.layout||"horizontal","grid"===this.layout){const t=parseInt(this.container.dataset.gridCols),e=parseInt(this.container.dataset.gridRows);t&&e?(this.gridCols=t,this.gridRows=e):(this.gridCols=Math.ceil(Math.sqrt(this.frameCount)),this.gridRows=Math.ceil(this.frameCount/this.gridCols)),this.frameWidth=this.img.naturalWidth/this.gridCols,this.frameHeight=this.img.naturalHeight/this.gridRows}else this.frameWidth=this.img.naturalWidth/this.frameCount,this.frameHeight=this.img.naturalHeight;const t=this.container.parentElement.offsetWidth,e=parseFloat(this.container.dataset.maxWidth)||t;if(this.scale=Math.min(1,e/this.frameWidth),this.displayWidth=this.frameWidth*this.scale,this.displayHeight=this.frameHeight*this.scale,this.container.style.cursor="grab",this.container.style.overflow="hidden",this.container.style.position="relative",this.container.style.userSelect="none",this.container.style.display="inline-block",this.container.style.width=`${this.displayWidth}px`,this.container.style.height=`${this.displayHeight}px`,this.img.style.display="block",this.img.style.maxWidth="none",this.img.style.position="relative",this.img.draggable=!1,"grid"===this.layout?(this.img.style.width=this.img.naturalWidth*this.scale+"px",this.img.style.height=this.img.naturalHeight*this.scale+"px",this.img.style.left="0px",this.img.style.top="0px"):(this.img.style.height=`${this.displayHeight}px`,this.img.style.width="auto",this.img.style.left="0px"),this.addIndicator(),this.addFullscreenButton(),this.addEventListeners(),this.updateFrame(0),this.syncGroup&&syncGroups[this.syncGroup]){const t=syncGroups[this.syncGroup].find((t=>t!==this&&t.isInitialized));t&&this.updateFrame(t.currentFrame,!1)}}addIndicator(){const t=document.createElement("div");t.className="viewer-360-indicator",t.innerHTML='\n      <svg height="28" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">\n        <path d="M12 7C6.5 7 2 9.2 2 12C2 14.2 4.9 16.1 9 16.8V20L13 16L9 12V14.7C5.8 14.1 4 12.8 4 12C4 10.9 7 9 12 9S20 10.9 20 12C20 12.7 18.5 13.9 16 14.5V16.6C19.5 15.8 22 14.1 22 12C22 9.2 17.5 7 12 7Z" fill="rgba(255, 255, 255, 0.9)" />\n      </svg>\n      <span>360Â°</span>\n    ',t.style.cssText="\n      position: absolute;\n      bottom: 8px;\n      left: 8px;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      background: rgba(0, 0, 0, 0.6);\n      color: white;\n      padding: 4px 8px;\n      border-radius: 4px;\n      font-size: 12px;\n      font-weight: bold;\n      pointer-events: none;\n      z-index: 3;\n      backdrop-filter: blur(4px);\n    ",this.container.appendChild(t),this.indicator=t}addFullscreenButton(){const t=document.createElement("button");t.className="viewer-360-fullscreen-btn",t.innerHTML='\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" fill="white"/>\n      </svg>\n    ',t.title="Maximize / Fullscreen",t.style.cssText="\n      position: absolute;\n      top: 8px;\n      right: 8px;\n      background: rgba(0, 0, 0, 0.6);\n      color: white;\n      border: none;\n      padding: 8px;\n      border-radius: 4px;\n      cursor: pointer;\n      z-index: 3;\n      backdrop-filter: blur(4px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s;\n      pointer-events: auto;\n    ",t.addEventListener("mouseenter",(()=>{t.style.background="rgba(0, 0, 0, 0.8)"})),t.addEventListener("mouseleave",(()=>{t.style.background="rgba(0, 0, 0, 0.6)"})),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.openFullscreen()})),t.addEventListener("touchstart",(t=>{t.stopPropagation(),t.preventDefault(),this.openFullscreen()}),{passive:!1}),this.container.appendChild(t),this.fullscreenButton=t}openFullscreen(){this.isFullscreen=!0;const t=document.createElement("div");t.className="viewer-360-fullscreen-overlay",t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100vw;\n      height: 100vh;\n      background: rgba(19, 19, 19, 1.0);\n      z-index: 9999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      animation: fadeIn 0.2s;\n    ";const e=this.container.dataset.title;if(e){const i=document.createElement("div");i.className="viewer-360-fullscreen-title",i.innerText=e,i.style.cssText="\n        position: absolute;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        color: white;\n        font-size: 20px;\n        font-weight: bold;\n        z-index: 10000;\n        pointer-events: none;\n      ",t.appendChild(i)}const i=document.createElement("div");i.style.cssText="\n      position: relative;\n      cursor: grab;\n      overflow: hidden;\n      user-select: none;\n    ";const s=window.innerWidth,n=window.innerHeight,r=this.frameWidth/this.frameHeight;let a,o;s/n>r?(o=Math.min(.9*n,this.frameHeight),a=o*r):(a=Math.min(.9*s,this.frameWidth),o=a/r),i.style.width=`${a}px`,i.style.height=`${o}px`;const h=this.img.cloneNode(!0);if(h.style.display="block",h.style.maxWidth="none",h.style.position="relative",h.draggable=!1,"grid"===this.layout){h.style.width=this.img.naturalWidth*(o/this.frameHeight)+"px",h.style.height=this.img.naturalHeight*(o/this.frameHeight)+"px";const t=this.currentFrame%this.gridCols,e=Math.floor(this.currentFrame/this.gridCols);h.style.left=-t*a+"px",h.style.top=-e*o+"px"}else h.style.height=`${o}px`,h.style.width="auto",h.style.left=-this.currentFrame*a+"px";i.appendChild(h);const l=this.indicator.cloneNode(!0);i.appendChild(l);const d=document.createElement("button");d.innerHTML='\n      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="white"/>\n      </svg>\n    ',d.style.cssText="\n      position: absolute;\n      top: 20px;\n      right: 20px;\n      background: rgba(0, 0, 0, 0.6);\n      color: white;\n      border: none;\n      padding: 12px;\n      border-radius: 4px;\n      cursor: pointer;\n      backdrop-filter: blur(4px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s;\n    ",d.addEventListener("mouseenter",(()=>{d.style.background="rgba(0, 0, 0, 0.8)"})),d.addEventListener("mouseleave",(()=>{d.style.background="rgba(0, 0, 0, 0.6)"})),t.appendChild(i),t.appendChild(d),document.body.appendChild(t),this.fsOverlay=t,this.fsContainer=i,this.fsImg=h,this.fsWidth=a,this.fsHeight=o,this.setupFullscreenListeners(i,h,d,t),document.body.style.overflow="hidden"}setupFullscreenListeners(t,e,i,s){let n=!1,r=0,a=this.currentFrame,o=0;const h=e=>{n=!0,r=e.type.includes("mouse")?e.clientX:e.touches[0].clientX,a=this.currentFrame,o=0,t.style.cursor="grabbing",e.type.includes("touch")&&e.preventDefault()},l=t=>{if(!n)return;const i=(t.type.includes("mouse")?t.clientX:t.touches[0].clientX)-r,s=(parseFloat(this.container.dataset.sensitivity)||10)*(this.fsWidth/400);o=i;const h=Math.floor(o/s);let l=(a+h)%this.frameCount;if(l<0&&(l+=this.frameCount),l!==this.currentFrame){if(this.currentFrame=l,"grid"===this.layout){const t=l%this.gridCols,i=Math.floor(l/this.gridCols),s=-t*this.fsWidth,n=-i*this.fsHeight;e.style.left=`${s}px`,e.style.top=`${n}px`}else{const t=-l*this.fsWidth;e.style.left=`${t}px`}this.updateFrame(l)}t.type.includes("touch")&&t.preventDefault()},d=()=>{n&&(n=!1,o=0,t.style.cursor="grab")},c=()=>{this.isFullscreen=!1,document.body.removeChild(s),document.body.style.overflow="",t.removeEventListener("mousedown",h),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",d),t.removeEventListener("touchstart",h),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",d)};t.addEventListener("mousedown",h),document.addEventListener("mousemove",l),document.addEventListener("mouseup",d),t.addEventListener("touchstart",h,{passive:!1}),document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchend",d),i.addEventListener("click",c),s.addEventListener("click",(t=>{t.target===s&&c()})),document.addEventListener("keydown",(function t(e){"Escape"===e.key&&(c(),document.removeEventListener("keydown",t))}))}addEventListeners(){this.container.addEventListener("mousedown",(t=>this.onDragStart(t))),document.addEventListener("mousemove",(t=>this.onDragMove(t))),document.addEventListener("mouseup",(()=>this.onDragEnd())),this.container.addEventListener("touchstart",(t=>this.onDragStart(t)),{passive:!1}),document.addEventListener("touchmove",(t=>this.onDragMove(t)),{passive:!1}),document.addEventListener("touchend",(()=>this.onDragEnd())),this.container.addEventListener("contextmenu",(t=>t.preventDefault())),window.addEventListener("resize",(()=>this.handleResize()))}handleResize(){if(!this.isInitialized)return;const t=this.container.parentElement.offsetWidth,e=parseFloat(this.container.dataset.maxWidth)||t,i=Math.min(1,e/this.frameWidth);Math.abs(i-this.scale)>.01&&(this.scale=i,this.displayWidth=this.frameWidth*this.scale,this.displayHeight=this.frameHeight*this.scale,this.container.style.width=`${this.displayWidth}px`,this.container.style.height=`${this.displayHeight}px`,"grid"===this.layout?(this.img.style.width=this.img.naturalWidth*this.scale+"px",this.img.style.height=this.img.naturalHeight*this.scale+"px"):this.img.style.height=`${this.displayHeight}px`,this.updateFrame(this.currentFrame,!1))}onDragStart(t){t.target.closest(".viewer-360-fullscreen-btn")||(this.isDragging=!0,this.startX=t.type.includes("mouse")?t.clientX:t.touches[0].clientX,this.startFrame=this.currentFrame,this.accumulatedDelta=0,this.container.style.cursor="grabbing",t.type.includes("touch")&&t.preventDefault())}onDragMove(t){if(!this.isDragging)return;const e=(t.type.includes("mouse")?t.clientX:t.touches[0].clientX)-this.startX,i=(parseFloat(this.container.dataset.sensitivity)||10)*(this.displayWidth/400);this.accumulatedDelta=e;const s=Math.floor(this.accumulatedDelta/i);let n=(this.startFrame+s)%this.frameCount;n<0&&(n+=this.frameCount),n!==this.currentFrame&&this.updateFrame(n),t.type.includes("touch")&&t.preventDefault()}onDragEnd(){this.isDragging&&(this.isDragging=!1,this.accumulatedDelta=0,this.container.style.cursor="grab")}updateFrame(t,e=!0){if(this.currentFrame=t,"grid"===this.layout){const e=t%this.gridCols,i=Math.floor(t/this.gridCols),s=-e*this.displayWidth,n=-i*this.displayHeight;this.img.style.left=`${s}px`,this.img.style.top=`${n}px`}else{const e=-t*this.displayWidth;this.img.style.left=`${e}px`}e&&this.syncGroup&&syncGroups[this.syncGroup]&&syncGroups[this.syncGroup].forEach((e=>{e!==this&&e.isInitialized&&e.currentFrame!==t&&e.updateFrame(t,!1)}))}}function initViewers(){document.querySelectorAll("[data-360-viewer]").forEach((t=>{new AssetViewer360(t)}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initViewers):initViewers();const contentObserver=new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{1===t.nodeType&&(t.hasAttribute&&t.hasAttribute("data-360-viewer")&&new AssetViewer360(t),t.querySelectorAll&&t.querySelectorAll("[data-360-viewer]").forEach((t=>{new AssetViewer360(t)})))}))}))}));contentObserver.observe(document.body,{childList:!0,subtree:!0}),window.AssetViewer360=AssetViewer360;